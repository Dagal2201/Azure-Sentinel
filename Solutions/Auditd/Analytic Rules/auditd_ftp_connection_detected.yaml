id: 8b2007a8-a7a8-4957-9463-00945a71d232
name: AuditD - Ftp connection detected
description: |
  This query is designed to flag FTP usage that could indicate malicious data transfer, such as infiltration or exfiltration
severity: Low
status: Available
requiredDataConnectors:
- connectorId: AuditDSyslog
  dataTypes:
  - Syslog
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
- InitialAccess
relevantTechniques:
- T1189
query: |-
  let keys = dynamic(["susp_activity_ftp"]);
  // getting event ids
  let auditEventIds = ASim_LinuxAuditdSyslog_V01(disabled=false)
      | where key in (keys)
      | project audit_event_id;
  // gettings events by their event id
  let auditEvents = ASim_LinuxAuditdSyslog_V01(disabled=false)
      | where audit_event_id in (auditEventIds);
  auditEvents
      | where isnotempty(all_args)
      | project ExecAt=TimeGenerated, Dvc, audit_event_id, all_args
entityMappings:
- entityType: IP
  fieldMappings:
  - identifier: Address
    columnName: IPCustomEntity
version: 1.0.0
kind: Scheduled
